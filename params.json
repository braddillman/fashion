{
  "name": "Fashion",
  "tagline": "A utility for simple model transformation and source code generation.",
  "body": "# Fashion\r\n\r\nFashion is a command line utility for simple model transformation and source code generation, aimed at a target audience of developers.\r\n\r\n## The problem\r\n\r\nIt only takes a few lines of code and a template library to throw together an ad hoc code generator. Many languages are suitable for writing transforms and generators. Models need not be complicated, or in strict formats like UML or MOF, be graphical, or even be usable by non-developers.\r\n\r\nThe problem is managing a growing number ad hoc models, transformations and code generators - and their dependencies.\r\n\r\n## The fashion solution\r\n\r\nThe three-legged stool of fashion:\r\n\r\n- A model is just a structured input file.\r\n- A transform is just a simple script.\r\n- A generator just substitutes values from a model into a template.\r\n\r\nFashion introduces a little structure, convention and metadata to make transformations and generators more managable. Python was selected as the language for transformation due to its' popularity and that no compilation step is required. Rather than introduce a new language for transformation, just learn python.\r\n\r\n### Models\r\n\r\nA model in fashion contains structured data, but no structure is prescribed. Typically a model resembles a key:value map like a python dictionary, but many structures are possible. A fashion model is not limited to UML or MOF-like formats. Fashion models are intended to be simple for developers to create, edit, diff and version control; they aren't intended to be used by non-developers.\r\n\r\n### Transforms\r\n\r\nA transform:\r\n- reads 0 or more input models,\r\n- produces 0 or more output models, (transformation)\r\n- generates 0 or more output files using 0 or more templates. (generation)\r\n\r\n\"0 or more\" means there is no requirement for a transform to either read input produce output. \"1 or more\" is more typical.\r\n\r\nA single transform could do any combination of both transformation and generation. It is up to you to keep models and transform scripts at a size you decide is managable.\r\n\r\n### Templates\r\n\r\nA template is a [Mako template](http://www.makotemplates.org/), which could look very similar to a source code file written in some programming language, with placeholders and looping driectives (in Mako syntax). \r\n\r\n### Hierarchy of models\r\n\r\nNote that templates are easier to read and contain less logic if the model they use is simple, and designed specifically for that template. A design intent of fashion is to use a hierarchy of simple models from very abstract, through more specific, to the final model which is specific to one template. \r\n\r\n## Installation\r\n\r\nFashion is a straightforward python 3.5 application. \r\n\r\n### prerequisites\r\n- install python 3.5+ \r\n\r\n### install from pip\r\n\r\nFashion is available from PyPi under the name fashionModel (fashion was already taken).\r\n\r\n\t$ pip install fashionModel\r\n\r\nI got caught by the local cache and couldn't get a newer version. The solution was:\r\n\r\n\t$ pip install --upgrade --no-cache-dir fashionModel\r\n\r\n## Getting started\r\n\r\nCreate a new directory for your target project.\r\n\r\n    $ mkdir greet\r\n    $ cd greet\r\n\r\nSet up fashion in this directory.\r\n\r\n    $ fashion init\r\n\r\nThis creates the subdirectory `fashion` and an empty fashion project.\r\n\r\nA fashion model is just a structured data file, typically in yaml format. Other formats are possible (e.g. json, xml, csv, ini, etc.). Any format is possible - as long as the transforms which use the model can parse it.\r\n\r\nCreate a simple model of kind 'greeting' in yaml format.\r\n\r\n    $ fashion create-model hellos.yaml greeting\r\n\r\nThis creates the file `fashion/model/hellos.yaml`.\r\n\r\nEdit the new model file. Initially it looks like:\r\n\r\n    # default empty yaml file\r\n\r\nAdd a list of greetings similar to hello, so that `hellos.yaml` looks like:\r\n\r\n    # List of words meaning hello\r\n    - Hello\r\n    - Hallo\r\n    - Bonjour\r\n\r\nTransforms are just python modules which strictly follow certain conventions, such as having functions with specific, pre-determined names. Otherwise, transforms can contain any legal python code, and dependencies (assuming the dependencies are properly installed and located, documentation coming soon).\r\n\r\nNow create a transform to change this model into an output source file.\r\n\r\n    $ fashion create-xform greetWorld\r\n\r\nThe empty transform should look like this:\r\n\r\n\t'''\r\n\tgreetWorld xform.\r\n\t'''\r\n\r\n\timport logging\r\n\r\n\tfrom fashion.xformUtil import readModels\r\n\tfrom fashion.xformUtil import generate\r\n\r\n\tdef inputKinds():\r\n\t    '''Inputs consumed by this xform'''\r\n\t    return [ ]\r\n\r\n\tdef outputKinds():\r\n\t    '''Outputs generated by this xform'''\r\n\t    return [ 'fashion_gen' ]\r\n\r\n\tdef police():\r\n\t    '''Validate input combinations.'''\r\n\t    pass\r\n\r\n\tdef xform():\r\n\t    '''Generate many source files from 2 input models.'''\r\n\t    logging.debug(\"greetWorld xform running\")\r\n\t    \r\n\t    model = {  }\r\n\t    \r\n\t    generate(model, \"myTemplate\", \"myTarget\")    \r\n\r\nEdit the transform to look like this:\r\n\r\n\t'''\r\n\tgreetWorld xform.\r\n\t'''\r\n\r\n\timport logging\r\n\r\n\tfrom fashion.xformUtil import readModels\r\n\tfrom fashion.xformUtil import generate\r\n\r\n\tdef inputKinds():\r\n\t    '''Input kinds consumed by this xform'''\r\n\t    return [ 'greeting' ]\r\n\r\n\tdef outputKinds():\r\n\t    '''Output kinds generated by this xform'''\r\n\t    return [ 'fashion_gen' ]\r\n\r\n\tdef police(greeting):\r\n\t    '''Validate input combinations.'''\r\n\t    pass\r\n\r\n\t# xform argument names must match input kinds exactly, but order not significant \r\n\tdef xform(greeting):\r\n\t    '''Generate source files input models.'''\r\n\t    logging.debug(\"greetWorld xform running\")\r\n\t    \r\n\t    # read all the greeting input models\r\n\t    # since each input model is a list, flatten=True \r\n\t    # changes list of lists [[],[], ...] into a flat list []\r\n\t    greetings = readModels(greeting, flatten=True)\r\n\t    # greetings should be ['Hello', 'Hallo', 'Bonjour']\r\n\r\n\t    # create the model handed to the template\r\n\t    model = { 'greetings': greetings }\r\n\t    \r\n\t    # generate the file from the template and the model\r\n\t    generate(model, \"greetWorld_template.c\", \"greetWorld.c\")\r\n\r\nTemplates are implemented by [Mako](http://www.makotemplates.org/). For details of template syntax, refer to the Mako documentation.\r\n\r\nCreate the template file fashion/template/greetWorld_template.c\r\n\r\n\t/* greetWorld.c */\r\n\r\n\t#include <stdio.h>\r\n\r\n\tmain() {\r\n\t% for greet in greetings:\r\n\t    printf(\"${greet} world!\\n\");\r\n\t% endfor\r\n\t}\r\n\r\nNow run the fashion `build` command, which executes all the transforms.\r\n\r\n\t$ fashion build\r\n\r\nThis should produce the file greetWorld.c which looks like;\r\n\r\n\t/* greetWorld.c */\r\n\r\n\t#include <stdio.h>\r\n\r\n\tmain() {\r\n\t    printf(\"Hello world!\\n\");\r\n\t    printf(\"Hallo world!\\n\");\r\n\t    printf(\"Bonjour world!\\n\");\r\n\t}\r\n\r\n### nab command\r\n\r\nNext, let's try to reverse engineer an existing file into a transform and template using the fashion 'nab' command.\r\n\r\nIf you were introducing fashion into an existing project, you'd expect there would already be existing source files. We'll create a file, and pretend this file already existed before we did `fashion init`.\r\n\r\nCreate `HelloWorld.java` with the content below:\r\n\r\n\tpublic class HelloWorld {\r\n\r\n\t\tpublic static void main(String[] args) {\r\n\t\t\tSystem.out.println(\"Hello, world!\");\r\n\t\t}\r\n\t}\r\n\r\nNow make that into a generated file:\r\n\r\n\t$ fashion nab HelloWorld.java\r\n\r\nThis creates a template `fashion/template/HelloWorld.java` and a transform `fashion/xform/HelloWorld.py`. The new template is identical to the generation target `HelloWorld.java`, just waiting for template placeholders to be added. Now we can modify the transform and template to finish our generation work.\r\n\r\nModify the template to look like:\r\n\r\n\tpublic class HelloWorld {\r\n\r\n\t\tpublic static void main(String[] args) {\r\n\t% for greet in greetings:\r\n\t\t\tSystem.out.println(\"${greet}, world!\");\r\n\t% endfor\r\n\t\t}\r\n\t}\r\n\r\nModify the transform to look like:\r\n\r\n\t'''\r\n\tHelloWorld xform.\r\n\t'''\r\n\r\n\timport logging\r\n\r\n\tfrom fashion.xformUtil import readModels\r\n\tfrom fashion.xformUtil import generate\r\n\r\n\tdef inputKinds():\r\n\t    '''Input kinds consumed by this xform'''\r\n\t    return [ 'greeting' ]\r\n\r\n\tdef outputKinds():\r\n\t    '''Output kinds generated by this xform'''\r\n\t    return [ 'fashion_gen' ]\r\n\r\n\tdef police(greeting):\r\n\t    '''Validate input combinations.'''\r\n\t    pass\r\n\r\n\tdef xform(greeting):\r\n\t    '''Generate source files input models.'''\r\n\t    logging.debug(\"HelloWorld xform running\")\r\n\t    \r\n\t    # read all the greeting input models\r\n\t    # since each input model is a list, flatten=True \r\n\t    # changes list of lists [[],[], ...] into a flat list []\r\n\t    greetings = readModels(greeting, flatten=True)\r\n\t    # greetings should be ['Hello', 'Hallo', 'Bonjour']\r\n\r\n\t    # create the model handed to the template\r\n\t    model = { 'greetings': greetings }\r\n\t    \r\n\t    # generate the file from the template and the model\r\n\t    generate(model, \"HelloWorld.java\", \"HelloWorld.java\")\r\n\r\nTest the new transform.\r\n\r\n\t$ fashion build\r\n\r\nThe output file `HelloWorld.java` should look like:\r\n\r\n\tpublic class HelloWorld {\r\n\r\n\t\tpublic static void main(String[] args) {\r\n\t\t\tSystem.out.println(\"Hello, world!\");\r\n\t\t\tSystem.out.println(\"Hallo, world!\");\r\n\t\t\tSystem.out.println(\"Bonjour, world!\");\r\n\t\t}\r\n\t}\r\n\r\nSo now we have source files in two languages generated from a common model.\r\n\r\n## Directory structure\r\n\r\nFashion creates a directory for itself under your project directory. Fashion is design to work within your existing project directory (as long as you don't already have a subdirectory named 'fashion'). The transformation and generation assets and metadata are stored under this directory.\r\n\r\n    fashion/\r\n    + bak/      # backup files (not yet implemented)\r\n    + mirror/   # copies of generated files to detect external modification\r\n    + model/    # model files go here\r\n    + template/ # template files go here\r\n    + tmplMods/ # mako compiles templates into python modules here\r\n    + xform/    # xforms (python modules) go here\r\n    + fashion.yaml  # model for this fashion project\r\n    + library.yaml  # library model for this fashion project\r\n    + fashion.db    # sqlite3 database for fashions' file metadata\r\n\r\n### version control\r\n\r\nIt is recommended to store your transformation and generation assets in your source code version control system, but not everything under `fashion/` needs to be controlled.\r\n\r\nControl these:\r\n\r\n    fashion/\r\n    + model/    # model files go here\r\n    + template/ # template files go here\r\n    + xform/    # xforms (python modules) go here\r\n    + fashion.yaml  # model for this fashion project\r\n    + library.yaml  # library model for this fashion project\r\n\r\nDon't control these:\r\n\r\n    fashion/\r\n    + bak/      # backup files (not yet implemented)\r\n    + mirror/   # copies of generated files to detect external modification\r\n    + tmplMods/ # mako compiles templates into python modules here\r\n    + fashion.db    # sqlite3 database for fashions' file metadata\r\n\r\n## The project model\r\n\r\nWhat's in fashion.yaml? Coming soon.\r\n\r\n## Libraries\r\n\r\nWhat's in library.yaml? Coming soon.\r\n\r\n## Dependencies\r\nThe following python libraries are used:\r\n- [Mako templates](http://www.makotemplates.org/) (MIT license)\r\n- [PyYAML](http://pyyaml.org/) (MIT license) Soon to be replaced by [ruamel](https://bitbucket.org/ruamel/yaml)\r\n- [peewee](http://docs.peewee-orm.com/en/latest/) (MIT license)\r\n\r\n## The name\r\n\r\nThink of \"fashion\" as a verb, e.g. \"I fashioned this code from this simple model.\"\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}