# Fashion

Fashion is a command line utility for simple model transformation and source code generation, aimed at a target audience of developers.

A model in fashion contains structured data, but no structure is prescribed. Typically a model resembles a key:value map like a python dictionary, but many structures are possible. A fashion model is not limited to UML or MOF-like formats. Fashion models are intended to be simple for developers to create and edit; they aren't intended to be

## The problem

Managing multiple ad hoc model transformations and code generation.

## Installation

Fashion is a straightforward python 3.5 application. 

### prerequisites
- install python 3.5+ 

### install from github
- TBD

### install from github pip
- TBD

## Getting started

Create a new directory for your target project.

    $ mkdir greet
    $ cd greet

Set up fashion in this directory.

    $ fashion init

This creates the subdirectory `fashion` and an empty fashion project.

Create a simple model of kind 'greeting'.

    $ fashion create-model hellos greeting

This creates the file `fashion/model/hellos.yaml`.

Edit the new model file. Initially it looks like:

    # default empty yaml file

Add a list of greetings similar to hello, so that `hellos.yaml` looks like:

    # List of words meaning hello
    - Hello
    - Hallo
    - Bonjour

Now create a transform to change this model into an output source file.

    $ fashion create-xform greetWorld

The empty transform should look like this:

	'''
	greetWorld xform.
	'''

	import logging

	from fashion.xformUtil import readModels
	from fashion.xformUtil import generate

	def inputKinds():
	    '''Inputs consumed by this xform'''
	    return [ ]

	def outputKinds():
	    '''Outputs generated by this xform'''
	    return [ 'fashion_gen' ]

	def police():
	    '''Validate input combinations.'''
	    pass

	def xform():
	    '''Generate many source files from 2 input models.'''
	    logging.debug("greetWorld xform running")
	    
	    model = {  }
	    
	    generate(model, "myTemplate", "myTarget")    

Edit the transform to look like this:

	'''
	greetWorld xform.
	'''

	import logging

	from fashion.xformUtil import readModels
	from fashion.xformUtil import generate

	def inputKinds():
	    '''Input kinds consumed by this xform'''
	    return [ 'greeting' ]

	def outputKinds():
	    '''Output kinds generated by this xform'''
	    return [ 'fashion_gen' ]

	def police():
	    '''Validate input combinations.'''
	    pass

	# xform argument names must match input kinds exactly, but order not significant 
	def xform(greeting):
	    '''Generate source files input models.'''
	    logging.debug("greetWorld xform running")
	    
	    # read all the greeting input models
	    # since each input model is a list, flatten=True 
	    # changes list of lists [[],[], ...] into a flat list []
	    greetings = readModels(greeting, flatten=True)
	    # greetings should be ['Hello', 'Hallo', 'Bonjour']

	    # create the model handed to the template
	    model = { 'greetings': greetings }
	    
	    # generate the file from the template and the model
	    generate(model, "greetWorld_template.c", "greetWorld.c")

Create the template file fashion/template/greetWorld_template.c

	/* greetWorld.c */

	#include <stdio.h>

	main() {
	% for greet in greetings:
	    printf("${greet} world!\n");
	% endfor
	}

Now run the fashion `build` command, which executes all the transforms.

	# fashion build

This should produce the file greetWorld.c which looks like;

	/* greetWorld.c */

	#include <stdio.h>

	main() {
	    printf("Hello world!\n");
	    printf("Hallo world!\n");
	    printf("Bonjour world!\n");
	}

Next, let's try to reverse engineer an existing file into a transform and template using the fashion 'nab' command.

- coming soon

## Dependencies
The following python libraries are used:
- [Mako templates](http://www.makotemplates.org/) (MIT license)
- [PyYAML](http://pyyaml.org/) (MIT license) Soon to be replaced by [ruamel](https://bitbucket.org/ruamel/yaml)
- [peewee](http://docs.peewee-orm.com/en/latest/) (MIT license)
